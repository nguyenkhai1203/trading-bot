# Trading Bot Development Task List

- [x] **Setup Environment & API Connection** <!-- id: 0 -->
    - [x] Create virtual environment and install dependencies (`ccxt`, `python-dotenv`, `pandas`, `numpy`) <!-- id: 1 -->
    - [x] Implement basic connection test script for Bybit/Binance <!-- id: 3 -->
- [x] **Data Fetching Module (Layer 1)** <!-- id: 4 -->
    - [x] Implement `DataFetcher` class with namespacing <!-- id: 5 -->
    - [x] Implement `MarketDataManager` to fix "Too Many Requests" <!-- id: 30 -->
    - [x] Implement Data Persistence (CSV) with exchange isolation <!-- id: 51 -->
- [x] **Decision Layer (Layer 2)** <!-- id: 8 -->
    - [x] Update `Strategy` to use Feature Engineer & return Confidence/Signal <!-- id: 10 -->
    - [x] Implement `WeightedScoringStrategy` (40+ Indicators) <!-- id: 32 -->
    - [x] Build `Analyzer` for Asset-Specific Weight Optimization <!-- id: 33 -->
    - [x] Implement Cross-Timeframe Validation (2-TF confirmation) <!-- id: 70 -->
    - [x] Integrate Neural Brain training into automated optimization flow <!-- id: 101 -->
- [x] **Risk Management (Layer 3)** <!-- id: 12 -->
    - [x] Implement `calculate_position_size` with Fixed Margin ($3/$8) <!-- id: 35 -->
    - [x] Implement ROE-Scaled SL/TP (5% SL / 10-20% TP ROE Targets) <!-- id: 75 -->
    - [x] Implement Profit Lock (SL to Profit at 80% TP) <!-- id: 75 -->
    - [x] Implement TA-based TP Extension (ATR/SR) <!-- id: 76 -->
- [x] **Order Execution & Adapters** <!-- id: 15 -->
    - [x] Implement `BaseAdapter` Interface (Unified behavior) <!-- id: 78 -->
    - [x] specific `BybitAdapter` (V5, Parent-Child Orders, Pagination) <!-- id: 79 -->
    - [x] specific `BinanceAdapter` (Algo Order support, Symbol Normalization) <!-- id: 80 -->
    - [x] Implement **Shared Trader Singleton** with Async Locking (Race Prevention) <!-- id: 54 -->
    - [x] Implementation of `_get_pos_key` (`EXCHANGE_SYMBOL_TIMEFRAME`) for absolute state isolation <!-- id: 110 -->
- [x] **Position Tracking & Synchronization** <!-- id: 19 -->
    - [x] Implement Persistent Position Storage (`positions.json`) <!-- id: 39 -->
    - [x] Implement **Authoritative Exchange-First Reality** for `/status` <!-- id: 80 -->
    - [x] Implement **Order Adoption Logic**: Sweep exchange for stray entries and adopt into local state <!-- id: 111 -->
    - [x] Implement **Hybrid Reality**: Public Mode simulation with virtual P&L fallback <!-- id: 83 -->
- [x] **Monitoring & Notifications** <!-- id: 22 -->
    - [x] Implement Telegram notification system with Rate Limiting <!-- id: 22 -->
    - [x] **Unified Exchange Logging**: Prepend `[EXCHANGE]` to all notifications <!-- id: 92 -->
    - [x] **Per-Exchange Optimization Reports**: Group symbols by exchange in `/optimize` <!-- id: 93 -->
- [x] **Bug Fixes & Hardening**
    - [x] Fix Bybit "Qty invalid" (Dynamic precision logic)
    - [x] Fix Bybit "Order Not Found" (Conditional order retry)
    - [x] Fix Binance SOL/ARB SL/TP cancellation (Algo order flag)
    - [x] Fix Dry-Run heartbeat hang (Skip live fetch, use cache)

- [ ] **Next Steps**
    - [ ] Add `/optimize` manual trigger via Telegram command <!-- id: 97 -->
    - [ ] Improve monthly/all-time summary reports <!-- id: 98 -->
    - [ ] Implement Summary Backtest phase in `run_global_optimization` <!-- id: 96 -->
